# ๐ ENGINEERING PROTOCOL  
## Apex Platform โ ุฅุตุฏุงุฑ 1.0 (ุฅูุฒุงูู ูุฌููุน ุฃุนุถุงุก ุงููุฑูู)

> โ๏ธ **ูุฐุง ููุณ ุฏููููุง ุชูููููุง โ ุจู ุนูุฏ ููุฏุณู ููุฒู.**  
> **ุฃู ุฎุฑู = ุฑูุถ PR + ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงูููุฏ + ุชูุฑูุฑ ุฃุฏุงุก ุณูุจู.**

---

## ๐ท 1. ุงููุจุฏุฃ ุงูุชุฃุณูุณู
> **"ุงููุธุงู ูุง ููุจูู ูููุตูุญ ูุงุญููุง. ููุจูู ุตุญูุญูุง ูู ุงูููู ุงูุฃูู."**

ูู ุณุทุฑ ููุฏ ูุฌุจ ุฃู ูุถูู:
- ุงูุนุฒู ุงูุชุงู ุจูู ุงููุณุชุฃุฌุฑูู (Tenant Isolation)
- ุนุฏู ูุฌูุฏ ุซุบุฑุงุช ุฃูุงู (Zero Trust)
- ูุงุจููุฉ ุงูุชูุณุน ุฅูู 1,000,000 ูุณุชุฃุฌุฑ
- ุฃุฏุงุก ุซุงุจุช ุชุญุช ุงูุถุบุท

---

## ๐ 2. ุงูููุงุนุฏ ุงูุฐูุจูุฉ (The Golden Rules)

| # | ุงููุงุนุฏุฉ | ุงูุนููุจุฉ ุนูุฏ ุงูุฎุฑู |
|---|--------|------------------|
| 1 | **ููููุน ุงุณุชุฎุฏุงู `any` ูู TypeScript** | ุฑูุถ PR ููุฑู |
| 2 | **ูู ุทูุจ ุฅูู ุงูู Backend ูุฌุจ ุฃู ูุญุชูู ุนูู Header: `Apex-Tenant-ID`** | ุฑูุถ PR + ุงุฎุชุจุงุฑ ุฃููู ุฅุถุงูู |
| 3 | **ูุง ููุณูุญ ุจุงููุตูู ุงููุจุงุดุฑ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฎุงุฑุฌ Prisma Client** | ุฅุนุงุฏุฉ ููููุฉ ูุงููุฉ ูููุญุฏุฉ |
| 4 | **ูู Endpoint ุญุณุงุณ ูุฌุจ ุฃู ููุฑ ุนุจุฑ Zod Validation** | ุฑูุถ PR |
| 5 | **ูุง ุชูุฌุฏ ุฃุณุฑุงุฑ (API keys, passwords) ูู ุงูููุฏ ุฃู `.env`** | ุฅููุงู ููุฑู + ูุฑุงุฌุนุฉ ุฃูููุฉ |

---

## ๐๏ธ 3. ููุงุนุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database Rules)

### ุฃ. ูู ูููุฐุฌ (Model) ูู `prisma/schema.prisma` ูุฌุจ ุฃู ูุญุชูู ุนูู:
```prisma
model Example {
  id        String   @id @default(uuid())
  tenantId  String   // โ ุฅูุฒุงูู
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId])
  @@unique([id, tenantId]) // โ ูููุน ุงูุชุฏุงุฎู
}
```

### ุจ. ุงูุนูุงูุงุช (Relations) ูุฌุจ ุฃู ุชููู **ูุดุชุฑูุฉ ุนูู tenantId**:
```prisma
category    Category? @relation(fields: [categoryId, tenantId], references: [id, tenantId])
categoryId  String?
```

### ุฌ. **ููููุน ุชูุงููุง**:
- `ON DELETE CASCADE`
- ุชุนุฏูู ุงูุญููู ุจุนุฏ ุงููุดุฑ ุฏูู Migration Test
- ุงุณุชุฎุฏุงู `String @default(cuid())` โ ููุท `uuid()`

---

## ๐งฑ 4. ููุงุนุฏ Monorepo ูุงููููู

### ุฃ. ุงููููู ุงูุฅูุฒุงูู:
```
apex-platform/
โโโ apps/          โ Frontends ููุท
โโโ packages/      โ Shared logic (zero side effects)
โโโ services/      โ Microservices (NestJS/FastAPI)
โโโ infra/         โ IaC ููุท
```

### ุจ. ูุง ููุณูุญ ุจู:
- ุงุณุชูุฑุงุฏ ูู `apps/` ุฅูู `packages/`
- ูุฌูุฏ business logic ูู `apps/`
- ุชูุฑุงุฑ ููุฏ ุจูู ุงูุชุทุจููุงุช โ ูุฌุจ ุชุฌุฑูุฏ ูู `packages/`

---

## ๐ 5. ููุงุนุฏ ุงูุจููุฉ ุงูุชุญุชูุฉ ูุงูููุงูุฐ (Infrastructure & Ports)

### ุฃ. ุชุนููู ุงูููุงูุฐ (Port Assignments)
ูุชู ุชุนููู ููุงูุฐ ุซุงุจุชุฉ ููู ุฎุฏูุฉ ูุถูุงู ุงูุชูุธูู ูููุน ุงูุชุถุงุฑุจ ูู ุงูุณูุฑูุฑุงุช ุงููุดุชุฑูุฉ:
- **Range ุงูุฅูุฒุงูู**: 7000 - 7020
- **PostgreSQL**: 7000
- **Redis**: 7001
- **Storage (MinIO)**: 7002 (API) / 7003 (Console)
- **Elasticsearch**: 7005
- **Backend API**: 7006
- **Storefront**: 7007
- **Tenant Admin**: 7008
- **Super Admin**: 7009
- **Marketing**: 7010

### ุจ. ุงูุนุฒู ุนูู ุงูุณูุฑูุฑ (Server Isolation)
- ูุฌุจ ุชุดุบูู ูู ูุดุฑูุน ุชุญุช ูุณุชุฎุฏู ูุธุงู (OS User) ูููุตู (ูุซุงู: `apex_admin`).
- ููููุน ุชุดุบูู ุฃู ุฎุฏูุฉ ุนูู ุงูููุงูุฐ ุงูุงูุชุฑุงุถูุฉ (80, 443, 3000, 5000) ูุจุงุดุฑุฉ ุจุฏูู Proxy.

---

## ๐ก๏ธ 6. ุงูุฃูุงู (Security)

### ุฃ. Authentication & Authorization
- ูู resolver ูู GraphQL ูุฌุจ ุฃู ููุฑ ุนุจุฑ Guard ูุชุญูู ูู:
  - ูุฌูุฏ `Apex-Tenant-ID`
  - ุตูุงุญูุฉ ุงููุณุชุฎุฏู ุฏุงุฎู ุฐูู ุงููุณุชุฃุฌุฑ

### ุจ. Rate Limiting
- Storefront: 100 req/min per IP
- Admin: 50 req/min per tenant
- Super Admin: 10 req/min per user

### ุฌ. Webhooks
- ุฌููุน webhooks (ูุซู Stripe) **ูุฌุจ** ุงูุชุญูู ูู ุงูุชูููุน ุงูุฑููู.

---

## ๐งช 6. ุงูุงุฎุชุจุงุฑุงุช (Testing)

| ุงูููุน | ุงูุญุฏ ุงูุฃุฏูู | ุงูุฃุฏุงุฉ |
|------|-----------|--------|
| Unit Tests | 85% ุชุบุทูุฉ | Vitest |
| Integration | ููู Endpoint ุฌุฏูุฏ | Supertest |
| E2E | ููู ูุณุงุฑ ูุณุชุฎุฏู ุฑุฆูุณู | Cypress |
| Security | Tenant Isolation Test | Custom |

> โ ูุง ููุณูุญ ุจุงูู Merge ุจุฏูู ุงุฌุชูุงุฒ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช.

---

## ๐ 7. CI/CD Requirements

ูู PR ูุฌุจ ุฃู ููุฑ ุจู:
```yaml
- pnpm lint
- pnpm type-check
- pnpm test:unit
- pnpm test:integration
- pnpm test:e2e
- sonarqube scan
```

> ุฅุฐุง ูุดู ุฃู ุฎุทูุฉ โ **ุงูู PR ูุบูู ุชููุงุฆูููุง**.

---

## โ 8. ูุงูุจ PR Checklist (ุฅูุฒุงูู ูู ูุตู ูู Pull Request)

```markdown
- [ ] ูุง ููุฌุฏ `any` ูู ุงูููุฏ
- [ ] ุชู ุชุถููู `Apex-Tenant-ID` ูู ูู ุทูุจ backend
- [ ] ุฌููุน ุงููุฏุฎูุงุช ุชู ุงูุชุญูู ูููุง ุนุจุฑ Zod
- [ ] ูุง ุชูุฌุฏ ุฃุณุฑุงุฑ ูู ุงูููุฏ
- [ ] ุชู ุชุญุฏูุซ `prisma/schema.prisma` (ุฅุฐุง ูุฒู)
- [ ] ุชู ูุชุงุจุฉ Unit Tests (Coverage โฅ 85%)
- [ ] ุชู ุชุดุบูู `pnpm lint && pnpm type-check`
- [ ] ุชู ุงุฎุชุจุงุฑ ุงูุนุฒู ุจูู ุงููุณุชุฃุฌุฑูู ูุฏููููุง
```

> โ **ุฅุฐุง ูู ููููุฃ ูุฐุง ุงููุงุฆูุฉ โ ูู ููุฑุงุฌุน ุงูู PR.**

---

## ๐ 9. ุงูุชุนุฑููุงุช ุงูุฃุณุงุณูุฉ

- **ุงููุณุชุฃุฌุฑ (Tenant)**: ูุชุฌุฑ ูุงุญุฏ ุนูู ุงูููุตุฉ (ูุซุงู: `acme-clothing`)
- **ุงูุนููู (Customer)**: ูุดุชุฑู ูู ูุชุฌุฑ ูุณุชุฃุฌุฑ
- **ุงููุณุชุฎุฏู (User)**: ุดุฎุต ูุฏูู ุญุณุงุจ ูู ููุญุฉ ุชุญูู ูุณุชุฃุฌุฑ
- **ุงูู Super Admin**: ูุฑูู Apex ููุท โ ูุง ูุฑู ุจูุงูุงุช ุงูุนููุงุก

---

## ๐ 10. ุงูุชูููุน

ุจูุจููู ุงูุงูุถูุงู ุฅูู ูุฑูู Apex Platformุ ูุฅูู ุชูุงูู ุนูู ุงูุงูุชุฒุงู ุงููุงูู ุจูุฐุง ุงูุจุฑูุชูููู.

> "ุงูููุฏุณุฉ ููุณุช ููููุง โ ุจู ุงูุถุจุงุท."  
> โ ูุฑูู ููุฏุณุฉ Apex Platform
